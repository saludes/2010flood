%% LyX 1.6.8 created this file.  For more info, see http://www.lyx.org/.
%% Do not edit unless you really know what you are doing.
\documentclass[12pt,a4paper,english]{article}
\usepackage[T1]{fontenc}
\usepackage[latin9]{inputenc}
\usepackage{amsmath}
\usepackage{graphicx}
\usepackage{amssymb}
\usepackage{esint}

\makeatletter

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% LyX specific LaTeX commands.
\special{papersize=\the\paperwidth,\the\paperheight}


\makeatother

\usepackage{babel}

\begin{document}
%% LyX 2.0.0 created this file.  For more info, see http://www.lyx.org/.
%% Do not edit unless you really know what you are doing.
%\documentclass[english]{article}
%\usepackage[T1]{fontenc}
%\usepackage[latin9]{inputenc}
%\usepackage{babel}
\global\long\def\Qf{q_{\mbox{f}}}
 \global\long\def\Qmao{q_{\mbox{mao}}}
 \global\long\def\Qmax{q_{\mbox{max}}}
 \global\long\def\Qi{q_{\mbox{i}}}
\global\long\def\Qmin{q_{\mbox{min}}}



\section{Introduction}

According to the EU directive \cite{eurlex}
\begin{quote}
\textquoteleft{}flood\textquoteright{} means the temporary covering
by water of land not normally covered by water. This shall include
floods from rivers, mountain torrents, Mediterranean ephemeral water
courses, and floods from the sea in coastal areas, and may exclude
floods from sewerage systems 
\end{quote}
The initial data is the forecasted flood hydrogram (the graph of the
discharge as a function of time) computed from observations at a point
upstream of the control point. 

We assume that the water height at the control point is a increasing
function of the discharge $Q$ at that point. Three parameters are
relevant:
\begin{itemize}
\item A threshold $\Qmin$ that corresponds to the level of the gates: For
$q<\Qmin$ the system is not controllable;
\item The \emph{typical maximum flooding} discharge $\Qmao>\Qmin$ is the
maximum discharge for a recurrent flood, one that happens every two
or three years. 
\item The maximum admisible discharge $\Qmax>\Qmao$, that makes the water
to spill over the floodable areas.
\end{itemize}

\section{Cutting the flood}

There are four stages and corresponding strategies when a flood is
imminent:
\begin{enumerate}
\item If the maximum forecast discharge $\Qi<\Qmao$, the gates are not
opened. 
\item $\Qi>\Qmao$: In this case we use the flooding areas to cut the upmost
part of the hydrogram to force a plateau at level $\Qf$ (the computed
maximum after the cutting) and we have $\Qf<\Qmax$. In this case
the areas will we drained into the river once the level becomes less
than $\Qmin$ again.
\item Similar to the previous stage, but now we forecast that, even using
the toal capacity $W$, we will have $\Qf>\Qmax$. In this case we
can avoid overflooding the areas, but want to delay this moment as
far as possible.
\item The hydrogram is not unimodal and $\Qi>\Qmao$, but $\Qf<\Qmax$.
This is similar to the stage~2.
\item Like stage~4 but now $\Qf>\Qmax$. This is similar to the stage~3.
\end{enumerate}
The forecast discharge $q(t)$ will be converted to $\tilde{q}(t)$
by the control actions such that:
\begin{itemize}
\item $q(t)=\tilde{q}(t)$ except for $t\in I=[a,b]$ (the controlling period) 
\item If for all $t$, $q(t)<\Qmin$, then $q(t)=\tilde{q}(t)$ (No gate
opening below this level) 
\item For all $t$: $\tilde{q}(t)\leq q(t)$, for all $t$; 
\item Denote by $W$ the total capacity of the floodable areas, Then \begin{equation}
\int(q(t)-\tilde{q}(t))\, dt\leq W.\label{eq:capacity}\end{equation}

\item If possible, ensure that $\Qf=\max\tilde{q}<\Qmax$ 
\end{itemize}
Define $R=Q-\tilde{Q}$. The previous conditions imply that $R$ is
positive, has support on $I$ and $\int R\, dt\leq V$. 

Let $I=(a,b)$ the control period. It is clear that to minimize $\max\tilde{q}$
this function must be constant $\tilde{q}(t)=\Qf$ on $I$, for otherwise
we could replace it for a constant equal to its mean value on $I$.
Thus \eqref{eq:capacity} could be written as: \begin{equation}
\int_{a}^{b}q\, dt\leq\Qf(b-a)+W,\label{eq:prob1}\end{equation}
 and the problem is to find $a$, $b$ and fulfiling \eqref{eq:prob1}
with $\Qf<\Qmax$. Add $Q(a)=Q(b)=q$ to \eqref{eq:prob1} and we
are set. To cut the most of the water we may impose equality on condition
\eqref{eq:prob1}. 


\subsection{The case of monotonic hydrograms}

When $q(t)$ has a single maximum at the time instant $a\leq t_{m}\leq b$
is it possible. Pick a reference instant $t_{0}<a$ and define \[
V(t)=\int_{t_{0}}^{t}q(\tau)\, d\tau.\]
Taking $f(x)=\Qi-q(x+t_{\mbox{m}})$, \eqref{eq:prob1} can be written
as\[
\int_{a}^{b}f(u)\, du\leq(\Qf+\Qi)(b-a)+W\]
So the equivalent problem for $f$ is: We have a unimodal non-negative
function $f(x)$ with $f(0)=0$ and constants $k$ and $W$ and wanted
to see whenever it exists $a<0<b$, such that $f(a)=f(b)=y$ and\[
\int_{a}^{b}f(x)\, dx\leq(y+k)(b-a)+W.\]
Using the mean value thorem, this is equivalent to

Notice that $V(t)$ is increasing, while $q(t)$ is increasing on
the subinterval $[a,t_{m}]$ and decreasing on $[t_{m},b]$ so we
can now take $t_{+}(q)$ and $t_{-}(q)$ the inverse functions of
$q(t)$ on these subintervals and define $V_{+}(q)=V(t_{+}^{-1}(q))$
on $[q(a),\Qi]$ and $V_{-}(q)=V(t_{-}^{-1}(q))$ in the interval
$[q(b),\Qi]$. Now consider \[
\Delta V(q)=V_{+}(q)-V_{-}(q)=\int_{t_{-}(q)}^{t_{+}(q)}q(\tau)\, d\tau.\]


Our goal is to find $\Qf$ such that $\Delta V(q)=W$. Then, seting
$a=t_{-}(\Qf$) and $b=t_{+}(q)$$f(q)$ is a decreasing function
whose range goes to zero. By binary bisection it is very easy to find
the point $q_{*}$ such that $f(q_{*})=V$.


\subsection{A numerical experiment}

??Describe the experiment??

%
\begin{figure}


\includegraphics[scale=0.3]{qt}\hfill{}\includegraphics[scale=0.3]{vq}

\caption{\textbf{Left}: $q(t)$ following a Rayleigh function and the cut volume
$W=350.$ corresponding to $q=\Qf$.\textbf{ Right}: $V(q)$ (blue)
and $\Delta V(q)$ (green) with the computed set point $\Qf$. }

\end{figure}



\section{Incorporating cost}

Let us now modify the assumption that the impact of flooding the urban
areas is constant by making it depend on the number of residents affected
by the flooding. Assume we have geographic data to describe $C(h)$,
the number of residents that live below heigh $h$. Let $C_{\mbox{f}}$
be the cost of flooding the fields, then the total cost will be \[
C=\left\{ \begin{array}{cc}
C(h) & \mbox{no flooding}\\
C_{\mbox{f}}+C(h(q_{*})) & \mbox{when flooding}\end{array}\right.\]
?? 
\end{document}
